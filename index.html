<script>
    // GitHub sources
    const sources = {
        1: 'https://raw.githubusercontent.com/liketolivefree/kobabi/main/sub.txt',
        2: 'https://raw.githubusercontent.com/sinavm/SVM/refs/heads/main/config.txt',
        3: 'https://raw.githubusercontent.com/Mosifree/-FREE2CONFIG/refs/heads/main/Movaghat',
        4: 'https://raw.githubusercontent.com/V2RAYCONFIGSPOOL/V2RAY_SUB/refs/heads/main/v2ray_configs.txt'
    };

    let currentConfig = '';

    document.addEventListener('DOMContentLoaded', function() {
        const buttons = document.querySelectorAll('.config-button');
        const resultContainer = document.getElementById('result');
        const configDisplay = document.getElementById('configDisplay');
        const copyButton = document.getElementById('copyButton');
        const errorDiv = document.getElementById('error');

        buttons.forEach(button => {
            button.addEventListener('click', function() {
                const source = this.getAttribute('data-source');
                const originalHTML = this.innerHTML;
                
                // Show loading state
                this.innerHTML = '<div class="loading"></div>در حال دریافت...';
                this.disabled = true;
                
                // Clear previous results
                resultContainer.classList.remove('show');
                errorDiv.textContent = '';
                
                // Fetch config from GitHub
                fetch(sources[source])
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.text();
                    })
                    .then(data => {
                        currentConfig = data.trim();
                        configDisplay.textContent = currentConfig;
                        resultContainer.classList.add('show');
                        
                        // Scroll to result
                        resultContainer.scrollIntoView({ 
                            behavior: 'smooth', 
                            block: 'nearest' 
                        });
                    })
                    .catch(error => {
                        errorDiv.textContent = 'خطا در دریافت کانفیگ: ' + error.message;
                        resultContainer.classList.add('show');
                    })
                    .finally(() => {
                        // Restore button
                        this.innerHTML = originalHTML;
                        this.disabled = false;
                    });
            });
        });

        copyButton.addEventListener('click', function() {
            if (currentConfig) {
                navigator.clipboard.writeText(currentConfig).then(() => {
                    const originalText = this.textContent;
                    this.textContent = '✅ کپی شد!';
                    this.classList.add('copied');
                    
                    setTimeout(() => {
                        this.textContent = originalText;
                        this.classList.remove('copied');
                    }, 2000);
                }).catch(err => {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = currentConfig;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    const originalText = this.textContent;
                    this.textContent = '✅ کپی شد!';
                    this.classList.add('copied');
                    
                    setTimeout(() => {
                        this.textContent = originalText;
                        this.classList.remove('copied');
                    }, 2000);
                });
            }
        });
    });
</script>
